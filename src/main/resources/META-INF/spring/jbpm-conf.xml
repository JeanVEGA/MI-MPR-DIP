<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:jbpm="http://drools.org/schema/drools-spring"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
                           http://drools.org/schema/drools-spring http://anonsvn.jboss.org/repos/labs/labs/jbossrules/trunk/drools-container/drools-spring/src/main/resources/org/drools/container/spring/drools-spring.xsd">

	<jbpm:kbase id="kbase">
		<jbpm:resources>
			<jbpm:resource type="BPMN2" source="classpath:bsp/2012_bsp_main.bpmn" />
			<jbpm:resource type="BPMN2" source="classpath:msp/2012_msp_main.bpmn" />
			
			<jbpm:resource type="BPMN2" source="classpath:process/register_to_study.bpmn" />
			<jbpm:resource type="BPMN2" source="classpath:process/apology_approval.bpmn" />
			<jbpm:resource type="BPMN2" source="classpath:process/document_request.bpmn" />
			<jbpm:resource type="BPMN2" source="classpath:process/2012_registration.bpmn" />
			<jbpm:resource type="BPMN2" source="classpath:process/2012_admission_test.bpmn" />
			<jbpm:resource type="BPMN2" source="classpath:process/2012_test.bpmn" />
			<jbpm:resource type="BPMN2" source="classpath:process/2012_decision.bpmn" />

			<jbpm:resource type="BPMN2" source="classpath:test/blank.bpmn" />
			<jbpm:resource type="BPMN2" source="classpath:test/test_email.bpmn" />
			<jbpm:resource type="BPMN2" source="classpath:test/test_user_task.bpmn" />
			
		</jbpm:resources>
	</jbpm:kbase>

	<jbpm:ksession id="ksession" type="stateful" kbase="kbase">
<!-- 		<jbpm:configuration> -->
<!-- 			<jbpm:jpa-persistence> -->
<!-- 				<jbpm:entity-manager-factory ref="entityManagerFactory" /> -->
<!-- 				<jbpm:transaction-manager ref="transactionManager" /> -->
<!-- 			</jbpm:jpa-persistence> -->
<!-- 		</jbpm:configuration> -->
	</jbpm:ksession>
 
	<bean id="processService" class="cz.cvut.fit.mi_mpr_dip.admission.jbpm.ProcessService">
		<property name="session" ref="ksession" />
	</bean>
 
	<!-- Declare a TaskServer 
	<bean class="org.jbpm.task.service.TaskService" id="taskService">
		<constructor-arg ref="entityManagerFactory" />
		<constructor-arg>
			<bean class="org.drools.SystemEventListenerFactory" factory-method="getSystemEventListener" />
		</constructor-arg>
	</bean>
	<bean class="org.jbpm.task.service.mina.MinaTaskServer" id="taskServer">
		<constructor-arg ref="taskService" />
		<constructor-arg>
			<value>${jbpm.task.server.port}</value>
		</constructor-arg>
	</bean>
	-->
	<!-- And start TaskServer on the configured port
	<bean class="java.lang.Thread" id="taskServerThread" init-method="start">
		<constructor-arg ref="taskServer" />
	</bean>
 -->
	<!-- Declare a TaskClient
	<bean class="org.jbpm.task.service.mina.MinaTaskClientConnector" id="taskClientConnector">
		<constructor-arg value="taskClient" />
		<constructor-arg>
			<bean class="org.jbpm.task.service.mina.MinaTaskClientHandler">
				<constructor-arg>
					<bean class="org.drools.SystemEventListenerFactory" factory-method="getSystemEventListener" />
				</constructor-arg>
			</bean>
		</constructor-arg>
	</bean>
	<bean class="org.jbpm.task.service.TaskClient" id="taskClient">
		<constructor-arg ref="taskClientConnector" />
	</bean>
 -->
	<!-- Declare a HumanTaskHandler. It uses previously created TaskClient
	<bean class="org.jbpm.task.service.AsyncTaskServiceWrapper" id="humanTaskClient">
		<constructor-arg ref="taskClient" />
	</bean>
	<bean class="org.jbpm.process.workitem.wsht.SyncWSHumanTaskHandler" id="humanTaskHandler">
		<constructor-arg ref="humanTaskClient" />
		<constructor-arg ref="ksession" />
	</bean>
	 -->
	<!-- Configure its connection to the local server
	<bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean" depends-on="humanTaskHandler" id="setConnection">
		<property name="targetObject" ref="humanTaskHandler" />
		<property name="targetMethod" value="setConnection" />
		<property name="arguments">
			<list>
				<value>${jbpm.task.client.address}</value>
				<value>${jbpm.task.client.port}</value>
			</list>
		</property>
	</bean>
	 -->
	<!-- And connect HumanTaskHandler (implicit TaskClient connection) 
	<bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean" depends-on="setConnection">
		<property name="targetObject" ref="humanTaskHandler" />
		<property name="targetMethod" value="connect" />
	</bean>
-->
	<!-- Finnaly, register HumanTaskHandler in the session
	<bean factory-bean="ksession" factory-method="getWorkItemManager" id="workItemManager" />
	<bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		<property name="targetObject" ref="workItemManager" />
		<property name="targetMethod" value="registerWorkItemHandler" />
		<property name="arguments">
			<list>
				<value>Human Task</value>
				<ref bean="humanTaskHandler" />
			</list>
		</property>
	</bean>
 -->
</beans>